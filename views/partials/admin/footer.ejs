<!-- jQuery -->
<script src="/admin/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/admin/js/bootstrap.min.js"></script>

<!-- Metis Menu Plugin JavaScript -->
<script src="/admin/js/metisMenu.min.js"></script>

<!-- DataTables JavaScript -->
<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.print.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.colVis.min.js"></script>

<script type="text/javascript">
    $(document).ready(function () {
        var table = $('#datatable').DataTable({
            lengthChange: false,
            buttons: [{
                    extend: 'copy',
                    text: 'Copy'
                },
                {
                    extend: 'excel',
                    text: 'Export ke  Excel',
                    filename: 'Data Yelpcamp', //BAGAIMANA BISA DINAMIS NAMA FILENYA
                    title: 'Data Yelpcamp' //JUDUL DI EXCELNYA
                },
                {
                    extend: 'pdf',
                    text: 'Export ke Pdf',
                    filename: 'Data Yelpcamp', //BAGAIMANA BISA DINAMIS NAMA FILENYA
                    title: 'Data Yelpcamp' //JUDUL DI PDF NYA
                },
                'colvis'
            ]
        });
        table.buttons().container()
            .appendTo('#datatable_wrapper .col-sm-6:eq(0)');
    });
</script>

<!-- Custom Theme JavaScript -->
<script src="/admin/js/sb-admin-2.js"></script>

<!-- Bootstrap Switch -->
<script src="/admin/js/bootstrap-switch.min.js"></script>

<!-- Toaster JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>


<!-- Page-Level Demo Scripts - Tables - Use for reference -->
<script>
    //  $(document).ready(function() {
    //      $('#dataTables-example').DataTable({
    //          responsive: true
    //      });
    //  });

    $("[name='approveComment']").bootstrapSwitch();
    $("[name='statusAkun']").bootstrapSwitch();

    //  $(document).ready(() => {
    //     $("[name='statusAkun']").on('switchChange.bootstrapSwitch', (e, data)=>{
    //         console.log("IT WORKS");
    //     });
    //  });

    $(document).ready(() => {
        $("[name='approveComment']").on('switchChange.bootstrapSwitch', function (e, data) {

            var id = $(this).attr('data-id');
            // const id = $(this);
            // console.log(id);

            $.ajax({
                type: "POST",
                url: '/admin/comments/approve-comment',
                data: {
                    id: id,
                    approveComment: data
                },
                cache: false,
                success: function (data) {
                    toastr.success(`Comment with id ${data._id} was updated`);
                }
            });
        });
    });

    $(document).ready(() => {
        $("[name='statusAkun']").on('switchChange.bootstrapSwitch', function (e, data) {

            var id_akun = $(this).attr('data-idAkun');

            $.ajax({
                type: "POST",
                url: '/statusAkun',
                data: {
                    id: id_akun,
                    statusAkun: data
                },
                cache: false,
                success: function (data) {
                    toastr.success(`Status user with id ${data._id} was updated`);
                }
            });
        });
    });
</script>

<!-- <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.3.min.js"></script> -->
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.13.0/jquery.validate.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.13.0/additional-methods.min.js"></script>
<script>
    $.validator.setDefaults({
        errorClass: 'help-block',
        highlight: function (element) {
            $(element)
                .closest('.form-group')
                .addClass('has-error');
        },
        unhighlight: function (element) {
            $(element)
                .closest('.form-group')
                .removeClass('has-error');
        },
        errorPlacement: function (error, element) {
            if (element.prop('type') === 'checkbox') {
                error.insertAfter(element.parent());
            } else {
                error.insertAfter(element);
            }
        }
    });

    $.validator.addMethod('strongPassword', function (value, element) {
        return this.optional(element) ||
            value.length >= 8 &&
            /\d/.test(value) &&
            /(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]/i.test(value);
    }, 'Your password must be at least 8 characters long and contain at least one number.')

    jQuery.validator.addMethod("accept", function (value, element, param) {
        return value.match(new RegExp("." + param + "$"));
    });

    var maxchars = 130;

    $('textarea').keyup(function () {
        var tlength = $(this).val().length;
        $(this).val($(this).val().substring(0, maxchars));
        var tlength = $(this).val().length;
        remain = maxchars - parseInt(tlength);
        $('#remain').text(remain);
    });

    //VALIDATION FOR POLIKLINIK
    $("#tambah_poliklinik").validate({
        rules: {
            nama_poliklinik: {
                required: true,
                accept: "[a-zA-Z\s]+",
                maxlength: 30
            }
        },
        messages: {
            nama_poliklinik: {
                accept: "Harus alphabet",
                maxlength: "Maksimal 30 huruf"
            }
        }
    });

    //VALIDATION FOR SPESIALIS
    $("#tambah_spesialis").validate({
        rules: {
            nama_spesialis: {
                required: true,
                accept: "[a-zA-Z\s]+",
                maxlength: 30
            }
        },
        messages: {
            nama_spesialis: {
                accept: "Harus alphabet",
                maxlength: "Maksimal 30 huruf"
            }
        }
    });

    //VALIDATION FOR POLIKLINIK
    $("#tambah_polikli").validate({
        rules: {
            nama_polikli: {
                required: true,
                accept: "[a-zA-Z\s]+",
                maxlength: 30
            },
            nomor_bpjs: {
                number: true
            },
            nomor_hp: {
                required: true,
                number: true,
                maxlength: 12
            },
            nama_ibu_kandung: {
                required: true,
                accept: "[a-zA-Z\s]+"
            },
            alamat: {
                required: true
            }
        },
        messages: {
            nama_lengkap: {
                accept: "nama harus mengandung alphabetdan tanpa spasi",
                maxlength: "Nama maksimal 30 huruf"
            },
            nomor_bpjs: {
                number: "Masukkan angka dengan benar !"
            }
        }
    });

    //VALIDATION FOR POLIKLINIK
    $("#tambah_pasien").validate({
        rules: {
            awal_berobat: {
                required: true
            },
            tanggal_lahir: {
                required: true
            },
            nama_pasien: {
                required: true,
                accept: "[a-zA-Z\s]+",
                maxlength: 30
            },
            no_rm: {
                required: true,
                number: true,
            },
            no_hp: {
                required: true,
                number: true,
                maxlength: 12
            },
            umur: {
                required: true,
                number: true,
                max: 80,
                min: 1
            },
            alamat: {
                required: true
            },
            pekerjaan: {
                required: true,
                accept: "[a-zA-Z\s]+",
                maxlength: 30
            },
        },
        messages: {
            awal_berobat: {
                required: "Tanggal awal berobat wajib diisi dengan benar !"
            },
            tanggal_lahir: {
                required: "Tanggal lahir wajib diisi dengan benar !"
            },
            nama_pasien: {
                accept: "Nama harus alphabet dan tidak boleh ada angka",
                maxlength: "Nama pasien maksimal 30 huruf"
            },
            no_rm: {
                number: "Masukkan angka dengan benar !",
                required: "No Rekamedis wajib diisi !"
            },
            no_hp: {
                required: "No hp wajib diisi dengan benar !",
                number: "Masukkan angka dengan benar !",
                maxlength: "No hp maksimal 12 angka"
            },
            umur: {
                required: "Umur wajib diisi dengan benar !",
                max: "Minimal umur 1 tahun & maksimal 80 tahun !",
                min: "Minimal umur 1 tahun & maksimal 80 tahun !"
            },
            alamat: {
                required: "Alamat wajib diisi dengan benar !"
            },
            pekerjaan: {
                required: "Pekerjaan wajib diisi dengan benar !",
                accept: "Nama harus alphabet dan tidak boleh ada angka",
                maxlength: "Nama pekerjaan maksimal 30 huruf"
            },
        }
    });

    function submitBday() {
        var Q4A = "";
        var Bdate = document.getElementById('tanggal_lahir').value;
        var Bday = +new Date(Bdate);
        Q4A += +~~((Date.now() - Bday) / (31557600000) + 1);
        var theBday = document.getElementById('resultBday');
        document.getElementById("umurku").value = Q4A;
    }
</script>

<script src="/admin/js/auto-complete.js"></script>
<script>
    var demo2 = new autoComplete({
        selector: '#nama_lengkap',
        minChars: 1,
        source: function (term, suggest) {
            term = term.toLowerCase();
            var contoh = $.getJSON("http://localhost:5000/rekamedis/contoh").then((res) => {
                var choices = res;
                var suggestions = [];
                for (i = 0; i < choices.length; i++)
                    if (~choices[i].toLowerCase().indexOf(term)) suggestions.push(choices[i]);
                suggest(suggestions);
            });

        }
    });

    $("#nama_pasien").on("change", function () {
        np = $(this).val();
        $.post("http://localhost:5000/rekamedis/cariibu", {
            np: np
        }).then((r) => {
            console.log(r);
            if (r.length > 0) {
                $("#nama_ibu").val(r[0].nama_ibu_kandung);
            } else {
                alert("Nama Tidak Ditemukan");
            }
        });
    });

    $("#nama_pasien").on("change", function () {
        np = $(this).val();
        $.post("http://localhost:5000/rekamedis/cariibu", {
            np: np
        }).then((r) => {
            console.log(r);
            if (r.length > 0) {
                $("#nomor_bpjs").val(r[0].nomor_bpjs);
            } else {
                alert("Nama Tidak Ditemukan");
            }
        });
    });
</script>
</body>

</html>